#include <math.h>
#include <stdio.h>
#include "globals.h"
#include "struct.h"


/****************************************************************************/
/*		SDVILFSmB.C				      */
/****************************************************************************/

#define	C	0.569504e-12
#define ndt1	25 
#define Ndt	ndt1-1
#define pi      3.1415926

static double	jmSmBdev[][3]={1.256981e-02,1.169000e+01,0.000000e+00,
1.777639e-02,1.148000e+01,3.113332e+03,
2.513961e-02,1.128000e+01,1.033783e+02,
3.556684e-02,1.104000e+01,-1.659380e+02,
5.029911e-02,1.068000e+01,-8.451421e+01,
7.113368e-02,1.015000e+01,1.172315e+02,
1.004988e-01,9.460000e+00,5.578039e+01,
1.421267e-01,8.580000e+00,6.686299e+01,
2.012461e-01,7.520000e+00,5.860050e+01,
2.844293e-01,6.360000e+00,3.939699e+01,
4.024922e-01,5.160000e+00,1.655771e+01,
5.692100e-01,3.900000e+00,9.335160e+00,
8.049845e-01,2.580000e+00,6.275321e+00,
1.140175e+00,1.330000e+00,5.516673e+00,
1.609348e+00,5.100000e-01,1.940661e+00,
2.275961e+00,1.500000e-01,3.745423e-01,
3.218695e+00,4.000000e-02,4.344549e-02,
4.551923e+00,1.000000e-02,1.067058e-02,
5.575482e+00,5.350000e-03,-4.556351e-04,
6.435728e+00,3.015000e-03,2.053450e-03,
7.882125e+00,1.340000e-03,1.773643e-04,
9.155872e+00,7.500000e-04,1.837747e-04,
1.114675e+01,3.330000e-04,4.854191e-05,
1.287129e+01,1.890000e-04,1.690316e-05,
1.820275e+01,4.720000e-05,3.596226e-06
};

/***************************************************************************/
/*									   */
/***************************************************************************/



/************************************************************************ */

double SDvilfSmB(double f, double d, double n, double t)
{
	int	j;
	double	B,D,wt,m,j1,j2,af;
	double	fij(),_iT1wSmB();
	double  I=0.5;

	/*
	if(delta == 0.0){
		af = jw112(1,t,w) + jw112(2,t,2*w);
	}
	else {
		j1 = fij(1,0,delta)*jw112(0,t,w)+
		     fij(1,1,delta)*jw112(1,t,w)+
		     fij(1,2,delta)*jw112(2,t,w);
		j2 = fij(2,0,delta)*jw112(0,t,2*w)+
		     fij(2,1,delta)*jw112(1,t,2*w)+
		     fij(2,2,delta)*jw112(2,t,2*w);
		af = j1 + j2;		
	}
	*/
	af = _iT1wSmB(0,t,2*pi*f);
/*	printf("%g\n", af);                          */
	af = 1.5*I*(I+1)*n*C*t/(d*d*d) * af;         

	return af;

}
/***************************************************************************/
/*							      */
/**************************************************************************/
double _iT1wSmB(k,t,w)
int	k;
double t,w;
{
	int	j,i,p;
	double	wt,m,af,*x,*y,*y2,*xx,*yy,ypn;
	double	*dvector();
	void	free_dvector(),dsplint(),dpolint();

	x  = dvector(1,Ndt+1);
	y  = dvector(1,Ndt+1);
	y2 = dvector(1,Ndt+1);

	wt = sqrt(w*t);
	for(j=0,i= -1;j<=Ndt;j++) {
		x[j+1] = jmSmBdev[j][0];
		y[j+1] = jmSmBdev[j][2*k+1];
		y2[j+1]= jmSmBdev[j][2*k+2];
		if(wt<=x[j+1] && i== -1) i=j+1;
	}
	switch(i) {
		case 1:
			dpolint(x,y,2,wt,&af,&m);
			break;
		case -1:
			af = y[Ndt+1]*x[Ndt+1]*x[Ndt+1]/(w*w);
/*
			xx = &x[Ndt];
			yy = &y[Ndt];
			dpolint(xx-1,yy-1,2,wt,&af,&m);
*/
			break;
		default:
			dsplint(x,y,y2,Ndt+1,wt,&af);
			break;
	}
	free_dvector(x,1,Ndt+1);
	free_dvector(y,1,Ndt+1);
	free_dvector(y2,1,Ndt+1);
	return af;
}
