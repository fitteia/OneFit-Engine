OneFit-Engine version: 0.9.112 ===> From Distribution: OneFit-Engine:ver<0.9.112>:auth<github:fitteia>:api<>


NAME
    onefite - Raku script interface to the OneFit-Engine (OFE)

SYNOPSIS
    onefite stands for OneFit Engine, OFE for short. It helps users to perform model fits to data.
    It aims at obtaining the "best fit with just one go" keeping true to the fitteia motto:

    "Keeping the simple easy, making the complex feasible, and getting the impossible within reach."

NOTE
    This man page is expected to help you take full advantage of onefite on both the server and client sides.

DESCRIPTION
    this is it

USAGE


  Basic commands

  * onefite

    onefite [-h|--help]


    Options

    [-h|--help] Basic help

  * Uninstall

    onefite uninstall


  * Help on models

    onefite help <model> [-q|--quiet]
    onefite help <model> <key> [-q|--quiet]


    Provides information on the <model> equation included in the models fitting library.
    Sub-option <key> provides just the specific information on the key.

    Options

    [-q|--quiet] No screen print of log information

  * List models

    onefite list [-q|--quiet]
    onefite list models [-q|--quiet]
    onefite list aliases [-q|--quiet]


    Lists models included in the models fitting library and aliases defined in $HOME/.local/etc/aliases.json
    Lists just the models
    Lists just the aliases

    Options

    [-q|--quiet] No screen print of log information

  * Paths finder

    onefite path [-s|--src] [-t] [-e|--examples] [-b|--bin] [-l|--lib] [-c|-C] [--log] [-a|--aliases]


    Paths to OneFit-Engine folders installed.
    Combined use with "cd" and "awk" in the examples below

    Options

    [-s|--src]       Source
    [-t]             Raku test folder
    [-e|--examples]  Examples folder
    [-b|--bin]       Binaries folder
    [-l|--lib]       Libraries folder
    [-c|-C]          C code/F code folders
    [--log]          Log folder
    [-a|--aliases]   Aliases folder

    Examples

    cd $(onefite path -s)
    vi $(onefite path -a)/aliases.json

  Files conversion

  * sav <--> json files conversion

    onefite convert <input-filename> <output-filename> [--work-folder=<Str>]


    Converts fitteia's sav files to OFE json files

    Options

    [--work-folder] Folder where the conversion will be performed

    Examples

    onefite convert some-fitteia-fit.sav ofe-version.json

  OFE service commands

  * Systemd service

    onefite service start [--ip=<Str>] [-d|--systemd-daemon] [-p|--port=<Int>]
    onefite service stop


    [start] Is: sudo systemctl daemon-reload; systemctl enable onefite.service; service onefite start
    [stop]  Is: kill -9 <start-web-engine>
    [--ip=<Str>]      Default '*'. For [--macos] or [--wsl] use --ip=127.0.0.1
    [-p|--port=<Int>] Default 8142. Check your Firewall just in case
    [-d|--systemd-daemon] Default False. For [--docker], [--macos], or [--wsl] keep the default.

  * LOG and PID services

    onefite service log
    onefite service PID


    Shows OFE service log file
    Prints OFE Process Identifier

  * OFE manual web service

    onefite start-web-engine [--ip[=Any]] [-p|--port[=Any]]
    onefite stop-web-engine
    (OBSOLETE) onefite start-engine [--no-plot] [-q|--quiet] [--work-folder=<Str>]


    User command line to start/stop OFE web service

  Create command

    onefite create <function> <data-files> ... [--data-label|--data-labels=<Str>] [--fit-methods=<Str>] [--tags=<Str>] [--autox] [--autoy] [--autoxy] [--logy|--linlog] [--logx|--loglin] [--logxy|--loglog] [--global] [--R1] [--sef-R1-file=<Str>] [--fit-if=<Str>] [--plot-if=<Str>] [--set-err|--err=<Str>] [--gfilt=<Int>] [--range=<Str>] [--SymbSize|--ssz=<Str>] [--save-to|--to=<Str>] [--work-folder=<Str>] [--Num|--npts[=Int]] [-q|--quiet]


    Creates a json file with the function and datafiles provided.

    Function

    The function syntax has the following rules:
        [ x < y ] Defines a range of values [ x ; y ], that is between x and y, inclusive. Spaces can be removed.
                  '<' and ';' can be used as limit separators but '<' presents fewer escape issues in argument passing
        ':'  Initializing symbol
        '='  Fix a value

    Example

        "Mz [-1 < 1] ( t[1e-3 < 10], M0:0.5[-1<1], Mi=1[-2<2], T1:0.5[1e-3 < 10]) = Mi \+ (M0-Mi)*exp(-t/T1)"
        Mz is the dependent variable with a plot range from -1 to 1. Mz is a function with arguments: t, M0, Mi, and T1
        t  is the independent variable with a plot range between 1e-3 and 10
        M0 is a model parameter initialized to 0.5 and the non-linear Least-Squares minimization performed by CERN lib MINUIT will be restricted to the range [-1;1]
        Mi is a model parameter with a fixed value 1 but a possible range [-2;2]
        T1 is a model parameter initialized to 0.5 in a range [1e-3; 10]

        The expression "Mi \+ (M0-Mi)*exp(-t/T1)" contains '\+' which sets plotting of individual model contributions to True

    Options

  Fit commands

    onefite random <function> <data-files> ... [--data-label|--data-labels=<Str>] [--tags=<Str>] [--zip-to=<Str>] [--no-plot] [--autox] [--autoy] [--autoxy] [--logy|--linlog] [--logx|--loglin] [--logxy|--loglog] [--global] [--save-to=<Str>] [--work-folder=<Str>] [--Num|--npts[=Int]]

    onefite fit <function> <data-files> ... [--data-label|--data-labels=<Str>] [--fit-methods=<Str>] [--tags=<Str>] [--zip-to=<Str>] [--no-plot] [--autox] [--autoy] [--autoxy] [--logy|--linlog] [--logx|--loglin] [--logxy|--loglog] [--global] [--R1] [--sef-R1-file=<Str>] [--fit-if=<Str>] [--plot-if=<Str>] [--set-err|--err=<Str>] [--gfilt=<Int>] [--range=<Str>] [--SymbSize|--ssz=<Str>] [--save-to=<Str>] [--work-folder=<Str>] [--Num|--npts[=Int]] [-q|--quiet] [--define-alias|--dali=<Str>] [--aux-code=<Str>] [--ro|--remove-outliers=<Str>] [--rchi2|--reduced-chi2]

    onefite fit <input-file> [--fit-methods=<Str>] [--no-plot] [--autox] [--autoy] [--autoxy] [--logy|--linlog] [--logx|--loglin] [--logxy|--loglog] [--save-to|--to=<Str>] [--zip-to=<Str>] [--work-folder=<Str>] [--Num|--npts[=Int]] [-q|--quiet] [--define-alias|--dali=<Str>] [--export] [--ro|--remove-outliers=<Str>] [--rchi2|--reduced-chi2]

    onefite plot <input-file> [--autox] [--autoy] [--autoxy] [--logy|--linlog] [--logx|--loglin] [--logxy|--loglog] [--work-folder=<Str>] [--Num|--npts[=Int]]

    onefite archive [-f||--fit=<Str>]


    Options

    [--define-alias|--dali=<Str>] adds alias Str to the function used to fit the data in the ./aliases.json file (overwrites existing alias)
    [--export] writes data and AuxCode to files for later use with: onefite fit <function>
    [--aux-code] accepts the name of the file with the AuxCode and the new fitting functions declarations

    Examples

    onefite fit "Mz(t[1e-3<20],M0,Mi,T1[1e-3<10])=Mi\\+(M0-Mi)*exp(-t/T1)" file.hdf5 --autox --logx --autoy
    onefite fit "Mz(t[1e-3<20],M0,Mi,T1[1e-3<10])=Mi\\+(M0-Mi)*exp(-t/T1)" file.hdf5 --autox --logx --autoy --define-alias=1exp
    onefite fit "alias: 1exp" file.hdf5 --autox --logx --autoy
    onefite fit "a: 1exp" file.hdf5 --autox --logx --autoy
    onefite fit "a: 1exp" file.txt --autox --logx --autoy
    onefite fit "a: 2BPP" *.dat --autox --logx --autoy --logy
    onefite fit "a: 1BPP" file.zip --autox --logx --autoy --logy
    onefite fit "a: 1BPP" file.zip --autox --logx --autoy --logy
    onefite fit "a: 1BPP" file.zip --autox --logx --autoy --logy --define-alias=1BPP

    onefite fit "#1exp" file.txt --autox --logx --autoy

    onefite fit \\#1BPP file.zip --autox --logx --autoy --logy --define-alias=1BPP

    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="1.0"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="x10/100"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="10x"

    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="1%"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="std"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="standard deviation"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="std split at 5"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="1% avg"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="1% average"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="10% avg split at 10.5"
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="10% avg split at 10.5" --remove-outliers=1
    onefite fit \\#1BPP file.zip --autox --logx --autoy --logy --define-alias=1BPP --reduced-chi2
    onefite fit \\#1BPP file.zip --autox --logx --autoy --logy --define-alias=1BPP --archive
    onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="10% avg split at 10.5" --remove-outliers=1 --ar

    onefite archive --fit last
    onefite archive -f last-1
    onefite log -f 2
    onefite log --fit=5

  Using awk to clean std output

  * just awk

	    onefite fit .... | awk '!/^-/ {print}'


  * combine with --quiet

	    onefite .... --quiet | awk '!/^-/ {print}'


  * combine with "2>/dev/null"

	    onefite .... 2>/dev/null | awk '!/^-/ {print}'


  * combine with tee

	    onefite .... | tee filename; awk '!/^-/ {print}' filename


  Built-in archiving

  * add to achive

        onefite fit \#1BPP file.zip --autox --logx --autoy --logy --define-alias=1BPP --archive
        onefite fit "y(x,a,b) = a \+ b*x" file.dat --set-err="10% avg split at 10.5" --remove-outliers=1 --ar


  * Show archive log

	    onefite archive || onefite ar || onefite log
	    onefite archive -f last
	    onefite log -f 2
	    onefite ar --fit last-3


  Version upgrade

    onefite upgrade [-u|--to-user] [-c|--compile] [-d|--systemd-daemon] [--test=<Str>] [--ip=<Str>] [-p|--port[=Int]] [-m|--merge-site=<Str>] [--cernlib] [--shell] [--shell-port=<Int>] [--wsl] [--macos] [--docker] [--dpkg]



    At the host prompt run I<onefite update -d --shell --test>

    This will upgrade the current (main or dev) version of the OneFit-Engine. github.com/fitteia/OneFit-Engine.git
    is downloaded and expanded. OneFit-Engine/INSTALL is called with options --systemd-daemon and --shell and --test.
    Port 8142 will be open to onefite requests.
    Port 8100 will be open to shell command access via a web browser.

    Options

    [-c|--compile] Compile the OneFit-Engine C and Fortran sources. Default True
    [--ip]          IP range access to the OneFit-Engine web service. Default '*'
    [-p]            Port number for the OneFit-Engine web service. Default 8142
    [-m|--merge-site=<Str>] Merge remote with local site <Str> sources. Default ''

    [-u|--to-user] Install OneFit-Engine in the user space. Default False
    [-d|--systemd-daemon] Create a systemd service and install it. Default False
    [--test]       Run install tests. Default False
    [--cernlib]    Use Debian cernlib package or compile from source. Default False
    [--shell]      Install a web shell service (default port 8100 or --shell-port). Default False
    [--shell-port] Port number for the web shell service. Default 8100
    [--dpkg]       Run apt update by default. Use --no-dpkg otherwise

    Use --/<option> or --no-<option> to negate defaults (e.g., --no-test or --/test)

  Test commands

    onefite test list
    onefite test [<arr> ...] [--verbose|-v] [-d|--systemd-daemon] [-p|--post-install]


PARAMETERS


  File parameters

  * input-file - name of the file to be converted (file extensions: .sav or
  .json)

  * output-file - name of the converted file (file extensions: .sav or .json)

  * data files - one or more files including plain text ASCII (.dat, .txt). Zip
  files are accepted. Special cases: Stelar S.R.l files (.sdf, .hdf5, .sef).

  Fit methods

  * fit-methods - simp scan min minos

sub MAIN(
	Bool :h(:$help), # help option true by default
)
Get onefite usage help

class Bool :h(:$help)
help option true by default

sub MAIN(
	Bool :$man = Bool::False, 
)
Get onefite man page

sub MAIN(
	"archive", 
	Str :f(:$fit) = "", # fit archive log entry: ex: onefite archive -f last or onefite log --fit 10
)
Show archive log

class Str :f(:$fit) = ""
fit archive log entry: ex: onefite archive -f last or onefite log --fit 10

sub MAIN(
	"ar", 
	Str :f(:$fit) = "", 
)
Show archive log

sub MAIN(
	"log", 
	Str :f(:$fit) = "", 
)
Show archive log

sub MAIN(
	"man", 
	Bool :m(:$man), 
)
Get onefite man page

sub MAIN(
	"list", 
	Bool :q(:$quiet) = Bool::False, # reduces output log info, false by default
)
Get onefite library models and aliases lists

class Bool :q(:$quiet) = Bool::False
reduces output log info, false by default

sub MAIN(
	"list", 
	"models", 
	Bool :q(:$quiet) = Bool::False, 
)
Get onefite library models list

sub MAIN(
	"list", 
	"aliases", 
	Bool :q(:$quiet) = Bool::False, 
)
Get onefite library models aliases list

sub MAIN(
	"convert", 
	Str $input-file where { ... }, # name of the file to be converted (sav or json)
	Str $output-file, # name of the converted file (sav or json)
	Str :$work-folder = ".", # work folder for onefite convert
)
onefite convert sav <-> json files

class Str $input-file where { ... }
name of the file to be converted (sav or json)

class Str $output-file
name of the converted file (sav or json)

class Str :$work-folder = "."
work folder for onefite convert

sub MAIN(
	"path", 
	Bool :s(:$src) = Bool::False, # path to src
	Bool :$t = Bool::False, # path to test
	Bool :e(:$examples) = Bool::False, # path to examples
	Bool :b(:$bin) = Bool::False, # path to bin
	Bool :l(:$lib) = Bool::False, # path to lib
	Bool :c(:$C) = Bool::False, # path to C code
	Bool :ar(:$archive) = Bool::False, # path to archive
	Bool :$log = Bool::False, # path to log
	Bool :a(:$aliases) = Bool::False, 
)
Get onefite paths to src, etc

class Bool :s(:$src) = Bool::False
path to src

class Bool :$t = Bool::False
path to test

class Bool :e(:$examples) = Bool::False
path to examples

class Bool :b(:$bin) = Bool::False
path to bin

class Bool :l(:$lib) = Bool::False
path to lib

class Bool :c(:$C) = Bool::False
path to C code

class Bool :ar(:$archive) = Bool::False
path to archive

class Bool :$log = Bool::False
path to log

sub MAIN(
	"upgrade", 
	Bool :u(:$to-user) = Bool::False, # install to user
	Bool :c(:$compile) = Bool::True, # compile before install
	Bool :d(:$systemd-daemon) = Bool::False, # create a sysmtemd-daemon service
	Bool :$cernlib = Bool::False, # install cern lib instead of just minuit.a from src
	Bool :$shell = Bool::False, # install shellinabox
	Int :$shell-port = 8100, # shellinabox port
	Str :$ip = "*", # set IP
	Bool :$wsl = Bool::False, # subset of options for a Windows Subsystem Linux
	Bool :$macos = Bool::False, # subset of options for a MacOS native install with brew
	Bool :$docker = Bool::False, # subset of options for a MacOS colima/docker install
	Int :p(:$port) = 8142, # onefite service port
	Bool :$test = Bool::False, # perform tests
	Bool :apt(:apt-get(:$dpkg)) = Bool::True, # run apt update/upgrade
	Str :m(:merge-from(:merge-with(:$merge-site))) = "", # merge remote onefite main/dev branches with locl branch
)
onefite upgrade

class Bool :u(:$to-user) = Bool::False
install to user

class Bool :c(:$compile) = Bool::True
compile before install

class Bool :d(:$systemd-daemon) = Bool::False
create a sysmtemd-daemon service

class Bool :$cernlib = Bool::False
install cern lib instead of just minuit.a from src

class Bool :$shell = Bool::False
install shellinabox

class Int :$shell-port = 8100
shellinabox port

class Str :$ip = "*"
set IP

class Bool :$wsl = Bool::False
subset of options for a Windows Subsystem Linux

class Bool :$macos = Bool::False
subset of options for a MacOS native install with brew

class Bool :$docker = Bool::False
subset of options for a MacOS colima/docker install

class Int :p(:$port) = 8142
onefite service port

class Bool :$test = Bool::False
perform tests

class Bool :apt(:apt-get(:$dpkg)) = Bool::True
run apt update/upgrade

class Str :m(:merge-from(:merge-with(:$merge-site))) = ""
merge remote onefite main/dev branches with locl branch

sub MAIN(
	"uninstall", 
)
onefite uninstall

sub MAIN(
	"service", 
	"start", 
	Bool :d(:$systemd-daemon) = Bool::False, # start systemd-daemon
	Str :$ip = "*", # accept access form IP
	Int :p(:$port) = 8142, # onefite werbservice port
)
onefite web service start

class Bool :d(:$systemd-daemon) = Bool::False
start systemd-daemon

class Str :$ip = "*"
accept access form IP

class Int :p(:$port) = 8142
onefite werbservice port

sub MAIN(
	"service", 
	"stop", 
)
onefite web service stop

sub MAIN(
	"service", 
	"log", 
)
onefite web service log

sub MAIN(
	"service", 
	"PID", 
)
get onefite service PID

sub MAIN(
	"stop-web-engine", 
)
onefite web service stop by removing service process

sub MAIN(
	"start-web-engine", 
	:$ip is copy, # run onefite web service in ip
	:p(:$port) = 8142, # onefite web service port
)
onefite web engine

class :$ip is copy
run onefite web service in ip

class :p(:$port) = 8142
onefite web service port

sub MAIN(
	"help", 
	Str $model, # model name
	Bool :q(:$quiet), # quiet for reduced log info
)
onefite help on models

class Str $model
model name

class Bool :q(:$quiet)
quiet for reduced log info

sub MAIN(
	"help", 
	Str $model, # model name
	Str $key, # model key info
	Bool :q(:$quiet), # quite for reduced log info
)
onefite help on model and keys

class Str $model
model name

class Str $key
model key info

class Bool :q(:$quiet)
quite for reduced log info

class Mu $
no plot

class Mu $
Don't show log messages

class Mu $
onefite engine work folder

sub MAIN(
	"create", 
	Str $function is copy, # fitting function
	*@data-files where { ... }, 
	Str :data-label(:$data-labels), # data labels and values
	Str :$fit-methods = "simp scan min minos", # minuit fit methods
	Str :$tags, # Data blocks TAGS
	Bool :$autox, # auto scale x
	Bool :$autoy, # auto scale y
	Bool :$autoxy, # auto scale both x and y
	Bool :logy(:$linlog), # logarithmic y scale
	Bool :logx(:$loglin), # logaroithmic x scale
	Bool :logxy(:$loglog), 
	Bool :$global = Bool::False, # global/individual
	Bool :ist-ffc-Mz(:$ist-ffc) = Bool::False, # import Mz data from ist-ffc
	Str :$fit-if = "", # include fit if condition when fitting data
	Str :$plot-if = "", # include plot if tag condition when plotting data and fitting curves
	Str :$sef-R1-file = "", # use file to get freqs when importing data from Stelar sef files
	Str :$range = "", # define range when importing data zones form Stelar data
	Bool :$R1 = Bool::False, # import R1 and not Mz data from ist-ffc files
	Int :$gfilt, # used a Gaussian filter to smooth data
	Str :set-err(:$err) = "", # set err in data files doesn't apply to ist-ffc, sef, hdf5 data files
	Str :SymbSize(:$ssz) where { ... } = "1.0", # set size of symbols
	Str :save-to(:$to), # write fit settings and results to json or sav file
	Str :$work-folder = ".", # set a different work folder
	Int :Num(:$npts) = Code.new, # number of points in the theoretical curves
	Bool :q(:$quiet) = Bool::False, # reduce log output
	Str :AuxCode(:auxcode(:$aux-code)) = "", # additional auxiliar code
	*%_, 
)
onefite create a json file from cmd line

class Str $function is copy
fitting function

class Str :data-label(:$data-labels)
data labels and values

class Str :$fit-methods = "simp scan min minos"
minuit fit methods

class Str :$tags
Data blocks TAGS

class Bool :$autox
auto scale x

class Bool :$autoy
auto scale y

class Bool :$autoxy
auto scale both x and y

class Bool :logy(:$linlog)
logarithmic y scale

class Bool :logx(:$loglin)
logaroithmic x scale

class Bool :$global = Bool::False
global/individual

class Bool :ist-ffc-Mz(:$ist-ffc) = Bool::False
import Mz data from ist-ffc

class Str :$fit-if = ""
include fit if condition when fitting data

class Str :$plot-if = ""
include plot if tag condition when plotting data and fitting curves

class Str :$sef-R1-file = ""
use file to get freqs when importing data from Stelar sef files

class Str :$range = ""
define range when importing data zones form Stelar data

class Bool :$R1 = Bool::False
import R1 and not Mz data from ist-ffc files

class Int :$gfilt
used a Gaussian filter to smooth data

class Str :set-err(:$err) = ""
set err in data files doesn't apply to ist-ffc, sef, hdf5 data files

class Str :SymbSize(:$ssz) where { ... } = "1.0"
set size of symbols

class Str :save-to(:$to)
write fit settings and results to json or sav file

class Str :$work-folder = "."
set a different work folder

class Int :Num(:$npts) = Code.new
number of points in the theoretical curves

class Bool :q(:$quiet) = Bool::False
reduce log output

class Str :AuxCode(:auxcode(:$aux-code)) = ""
additional auxiliar code

class Mu $
recalculate parameters' errors for a Chi2 ~ Number of Degrees of Freedom

class Mu $
add log entry and archive data

class Mu $
remove outliers (ex: --ro=2 or --ro=2..5, or --ro=1,3,5)


OneFit-Engine version: 0.9.112 ===> From Distribution: OneFit-Engine:ver<0.9.112>:auth<github:fitteia>:api<>


