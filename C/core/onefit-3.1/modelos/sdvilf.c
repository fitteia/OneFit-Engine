/******************************************************************************/
/*				SDVILF.C				      */
/******************************************************************************/
#include <math.h>
#include <stdio.h>
#include "sdvilf.h"
#include "fij.h"
#include "fitutils.h"

#define	C	0.569504e-12
#define ndt1	20
#define Ndt	ndt1-1

static double	jwdev[][7]={
1.000000e-03,2.246634e+01,0.000000e+00,1.394476e+00,0.000000e+00,5.402251e+00,0.000000e+00,
1.414214e-03,2.246634e+01,-7.937114e+00,1.394476e+00,-4.793030e-01,5.402251e+00,-5.037703e-01,
3.162278e-03,2.246631e+01,-3.927005e+01,1.394475e+00,-7.777724e-01,5.402250e+00,-7.172425e-01,
4.472136e-03,2.246622e+01,-4.217492e+01,1.394472e+00,-3.599617e+00,5.402247e+00,-3.849584e+00,
1.000000e-02,2.246328e+01,-3.890560e+02,1.394369e+00,-8.648941e+00,5.402152e+00,-6.474068e+00,
2.514756e-02,2.235722e+01,-1.485300e+03,1.390530e+00,-6.808381e+01,5.398453e+00,-7.084200e+01,
3.556403e-02,2.213025e+01,-6.617259e+02,1.381559e+00,-3.336422e+00,5.388636e+00,-4.506681e+01,
2.011964e-01,1.285992e+01,2.619366e+02,1.167190e+00,-4.311580e+00,4.812133e+00,8.312644e+00,
4.023804e-01,5.130375e+00,1.129916e+02,8.016513e-01,2.880874e+00,4.013020e+00,-7.865946e+00,
5.690518e-01,2.689386e+00,4.093061e+01,5.473202e-01,2.963291e+00,3.248247e+00,2.495645e+00,
8.047608e-01,1.356990e+00,9.269794e+00,3.155800e-01,1.662152e+00,2.231005e+00,3.986521e+00,
1.138104e+00,6.436660e-01,2.637320e+00,1.458190e-01,7.595399e-01,1.166577e+00,4.828473e+00,
1.609503e+00,2.462292e-01,9.463752e-01,5.286182e-02,2.034620e-01,4.408374e-01,1.743040e+00,
2.276181e+00,7.378392e-02,1.639349e-01,1.547999e-02,3.836397e-02,1.299002e-01,2.929501e-01,
2.449490e+00,5.602942e-02,1.787639e-01,1.172903e-02,3.737446e-02,9.845058e-02,3.196443e-01,
2.645751e+00,4.176997e-02,9.268813e-02,8.728654e-03,1.966627e-02,7.327866e-02,1.641702e-01,
3.464102e+00,1.461191e-02,1.667316e-02,3.043432e-03,3.421961e-03,2.555569e-02,2.905070e-02,
3.741657e+00,1.077709e-02,1.377719e-02,2.243674e-03,2.883252e-03,1.884049e-02,2.417404e-02,
4.898979e+00,3.693591e-03,1.736682e-03,7.683198e-04,3.592583e-04,6.451889e-03,3.024487e-03,
6.928203e+00,9.259841e-04,7.528201e-04,1.925550e-04,1.576683e-04,1.616976e-03,1.320161e-03
};

/******************************************************************************/
/*									      */
/******************************************************************************/
double sdvilf7(double I,double d,double n,double t,double w,double delta)
// double I,d,n,t,w,delta;
{
	int	j;
	double	B,D,wt,m,j1,j2,af;

	if(delta == 0.0){
		af = jw7(1,t,w) + jw7(2,t,2*w);
	}
	else {
		j1 = fij(1,0,delta)*jw7(0,t,w)+
		     fij(1,1,delta)*jw7(1,t,w)+
		     fij(1,2,delta)*jw7(2,t,w);
		j2 = fij(2,0,delta)*jw7(0,t,2*w)+
		     fij(2,1,delta)*jw7(1,t,2*w)+
		     fij(2,2,delta)*jw7(2,t,2*w);
		af = j1 + j2;		
	}
	af = 1.5*I*(I+1)*n*C*t/(d*d*d) * af;
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double jw7(int k,double t,double w)
// int	k;
// double t,w;
{
	int	j,i,p;
	double	wt,m,af,*x,*y,*y2,*xx,*yy,ypn;

	x  = dvector(1,Ndt+1);
	y  = dvector(1,Ndt+1);
	y2 = dvector(1,Ndt+1);

	wt = sqrt(w*t);
	for(j=0,i= -1;j<=Ndt;j++) {
		x[j+1] = jwdev[j][0];
		y[j+1] = jwdev[j][2*k+1];
		y2[j+1]= jwdev[j][2*k+2];
		if(wt<=x[j+1] && i== -1) i=j+1;
	}
	switch(i) {
		case 1:
			dpolint(x,y,2,wt,&af,&m);
			break;
		case -1:
			af = y[Ndt+1]*x[Ndt+1]*x[Ndt+1]/(w*w);
/*
			xx = &x[Ndt];
			yy = &y[Ndt];
			dpolint(xx-1,yy-1,2,wt,&af,&m);
*/
			break;
		default:
			dsplint(x,y,y2,Ndt+1,wt,&af);
			break;
	}
	free_dvector(x,1,Ndt+1);
	free_dvector(y,1,Ndt+1);
	free_dvector(y2,1,Ndt+1);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double	jwd7(int i,double t,double w,double delta)
// int	i;
// double	t,w,delta;
{
	int	j;
	double	af;

	for(j=0,af=0.0;j<=2;j++) af += fij(i,j,delta)*jw7(j,t,w);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double t1ro7(double I,double d,double n,double t,double w,double w0,double delta)
// double I,d,n,t,w,w0,delta;
/* B*(J0(2*w1)+10*J1(w0)+J2(2*w0) */
{
	int	j;
	double	B,D,wt,w0t,w2t,m,J0,J1,J2,af;

	J0 = jwd7(0,t,2*w,delta);
	J1 = jwd7(1,t,w0,delta);
	J2 = jwd7(2,t,2*w0,delta);
	
/*	printf("J0=%lg J1=%lg J2=%lg\n",J0,J1,J2);	*/
	af = 3.0/8.0*I*(I+1)*n*C*t/(d*d*d) * (J0 + 10*J1 + J2);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
