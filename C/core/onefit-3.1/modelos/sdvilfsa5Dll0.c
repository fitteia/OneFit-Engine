/******************************************************************************/
/*				SDVILFSA5Dll0.C				      */
/******************************************************************************/
#include <math.h>
#include <stdio.h>
#include "sdvilfsa5Dll0.h"
#include "fitutil.h"
#include "fij.h"

#define	C	0.569504e-12
#define ndt1	33
#define Ndt	ndt1-1

static double	jwdev[][7]={
 1.0000e-02, 8.4822e+01, 0.0000e+00, 1.9497e+00, 0.0000e+00, 5.8844e+00, 0.0000e+00,
 1.7321e-02, 7.0310e+01, 7.0666e+04, 1.9107e+00,-1.1356e+01, 5.8747e+00,-1.3732e+02,
 2.2361e-02, 6.2317e+01, 1.2532e+05, 1.8845e+00, 2.0370e+02, 5.8647e+00,-1.0466e+02,
 2.6458e-02, 5.7741e+01, 4.0595e+04, 1.8657e+00,-1.1694e+01, 5.8544e+00,-1.2898e+02,
 3.0000e-02, 5.4520e+01, 3.2226e+04, 1.8498e+00, 1.5956e+01, 5.8439e+00,-9.0569e+01,
 3.1623e-02, 5.3185e+01, 2.5543e+04, 1.8425e+00, 6.7539e+00, 5.8387e+00,-8.2511e+01,
 3.3166e-02, 5.1979e+01, 2.3687e+04, 1.8357e+00, 4.9894e+01, 5.8336e+00,-3.9386e+01,
 5.4772e-02, 4.0042e+01, 1.0888e+04, 1.7513e+00, 3.9503e+01, 5.7547e+00, 2.4606e+00,
 7.0711e-02, 3.4951e+01, 4.3305e+03, 1.6993e+00,-1.2858e+01, 5.6932e+00,-3.5929e+01,
 8.3666e-02, 3.1765e+01, 1.2990e+03, 1.6559e+00,-3.0094e+01, 5.6373e+00,-5.2254e+01,
 9.4868e-02, 2.9235e+01, 1.7921e+02, 1.6147e+00,-3.3336e+01, 5.5823e+00,-5.2995e+01,
 1.0000e-01, 2.8096e+01, 6.4843e+02, 1.5946e+00,-7.8328e+00, 5.5551e+00,-1.6360e+01,
 1.7321e-01, 1.4983e+01, 2.1033e+03, 1.3221e+00, 3.5771e+01, 5.1674e+00, 3.9696e+01,
 2.2361e-01, 1.0929e+01, 4.9016e+02, 1.2038e+00,-4.4478e-01, 4.9679e+00,-1.1772e+01,
 2.6458e-01, 9.0444e+00, 2.6966e+02, 1.1189e+00,-1.7677e+00, 4.8011e+00,-1.2578e+01,
 3.0000e-01, 7.8016e+00, 1.1910e+02, 1.0432e+00,-2.4499e+00, 4.6403e+00,-1.1897e+01,
 3.1623e-01, 7.2966e+00, 1.1963e+02, 1.0079e+00, 2.5442e+00, 4.5620e+00,-2.4680e+00,
 5.4772e-01, 2.9250e+00, 5.2672e+01, 5.8669e-01, 4.0929e+00, 3.4136e+00, 2.6380e+00,
 7.0711e-01, 1.8109e+00, 1.5643e+01, 4.0493e-01, 1.7862e+00, 2.6738e+00, 2.6694e+00,
 8.3666e-01, 1.3096e+00, 9.9455e+00, 2.9856e-01, 1.7903e+00, 2.1287e+00, 4.9370e+00,
 9.4868e-01, 1.0152e+00, 5.5350e+00, 2.2970e-01, 1.2644e+00, 1.7190e+00, 5.0974e+00,
 1.0000e+00, 9.0762e-01, 5.0959e+00, 2.0393e-01, 1.2025e+00, 1.5525e+00, 5.1253e+00,
 1.0488e+00, 8.1725e-01, 3.4456e+00, 1.8226e-01, 8.8039e-01, 1.4067e+00, 5.0757e+00,
 1.7321e+00, 2.0281e-01, 6.1524e-01, 4.2086e-02, 1.2513e-01, 3.4465e-01, 1.3443e+00,
 2.2361e+00, 8.2116e-02, 2.8559e-01, 1.6808e-02, 6.2274e-02, 1.3806e-01, 4.1120e-01,
 2.6458e+00, 4.3473e-02, 9.4817e-02, 8.8617e-03, 1.8715e-02, 7.2824e-02, 1.8265e-01,
 3.0000e+00, 2.6720e-02, 5.7378e-02, 5.4373e-03, 1.2051e-02, 4.4688e-02, 8.8633e-02,
 3.1623e+00, 2.1746e-02, 4.2837e-02, 4.4227e-03, 8.6881e-03, 3.6350e-02, 7.4067e-02,
 3.3166e+00, 1.8035e-02, 2.0992e-02, 3.6666e-03, 4.2843e-03, 3.0136e-02, 3.5104e-02,
 5.4772e+00, 2.4606e-03,-1.2959e-03, 4.9946e-04,-2.6791e-04, 4.1053e-03,-2.1685e-03,
 7.0711e+00, 8.8712e-04, 1.0677e-03, 1.8004e-04, 2.1819e-04, 1.4799e-03, 1.7835e-03,
 8.3666e+00, 4.5280e-04,-1.4873e-04, 9.1893e-05,-3.0634e-05, 7.5531e-04,-2.4879e-04,
 9.4868e+00, 2.7396e-04, 3.4722e-04, 5.5598e-05, 7.0694e-05, 4.5699e-04, 5.7956e-04
};

/******************************************************************************/
/*									      */
/******************************************************************************/
double sdvilfSa5_0(double I,double d,double n,double t,double w,double delta)
// double I,d,n,t,w,delta;
{
	int	j;
	double	B,D,wt,m,j1,j2,af;

	if(delta == 0.0){
		af = jw5_0(1,t,w) + jw5_0(2,t,2*w);
	}
	else {
		j1 = fij(1,0,delta)*jw5_0(0,t,w)+
		     fij(1,1,delta)*jw5_0(1,t,w)+
		     fij(1,2,delta)*jw5_0(2,t,w);
		j2 = fij(2,0,delta)*jw5_0(0,t,2*w)+
		     fij(2,1,delta)*jw5_0(1,t,2*w)+
		     fij(2,2,delta)*jw5_0(2,t,2*w);
		af = j1 + j2;		
	}
	af = 1.5*I*(I+1)*n*C*t/(d*d*d) * af;
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double jw5_0(int k,double t,double w)
// int	k;
// double t,w;
{
	int	j,i,p;
	double	wt,m,af,*x,*y,*y2,*xx,*yy,ypn;

	x  = dvector(1,Ndt+1);
	y  = dvector(1,Ndt+1);
	y2 = dvector(1,Ndt+1);

	wt = sqrt(w*t);
	for(j=0,i= -1;j<=Ndt;j++) {
		x[j+1] = jwdev[j][0];
		y[j+1] = jwdev[j][2*k+1];
		y2[j+1]= jwdev[j][2*k+2];
		if(wt<=x[j+1] && i== -1) i=j+1;
	}
	switch(i) {
		case 1:
			dpolint(x,y,2,wt,&af,&m);
			break;
		case -1:
			af = y[Ndt+1]*x[Ndt+1]*x[Ndt+1]/(w*w);
/*
			xx = &x[Ndt];
			yy = &y[Ndt];
			dpolint(xx-1,yy-1,2,wt,&af,&m);
*/
			break;
		default:
			dsplint(x,y,y2,Ndt+1,wt,&af);
			break;
	}
	free_dvector(x,1,Ndt+1);
	free_dvector(y,1,Ndt+1);
	free_dvector(y2,1,Ndt+1);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double	jwd7(int i,double t,double w,double delta)
// int	i;
// double	t,w,delta;
{
	int	j;
	double	af;

	for(j=0,af=0.0;j<=2;j++) af += fij(i,j,delta)*jw5_0(j,t,w);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double t1ro5_0(double I,double d,double n,double t,double w,double w0,double delta)
// double I,d,n,t,w,w0,delta;
/* B*(J0(2*w1)+10*J1(w0)+J2(2*w0) */
{
	int	j;
	double	B,D,wt,w0t,w2t,m,J0,J1,J2,af;

	J0 = jwd5_0(0,t,2*w,delta);
	J1 = jwd5_0(1,t,w0,delta);
	J2 = jwd5_0(2,t,2*w0,delta);
	
/*	printf("J0=%lg J1=%lg J2=%lg\n",J0,J1,J2);	*/
	af = 3.0/8.0*I*(I+1)*n*C*t/(d*d*d) * (J0 + 10*J1 + J2);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
