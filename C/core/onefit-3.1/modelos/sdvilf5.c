
/******************************************************************************/
/*				SDVILF5.C				      */
/******************************************************************************/
#include <math.h>
#include <stdio.h>
#include "sdvilf5.h"
#include "fitutil.h"
#include "fij.h"

#define	C	0.569504e-12
#define ndt1	14
#define Ndt	ndt1-1

static double	jwdev[][7]={
3.162278e-03,1.953609e+01,0.000000e+00,1.299774e+00,0.000000e+00,5.291247e+00,0.000000e+00,
4.472136e-03,1.953600e+01,-6.180264e+01,1.299771e+00,-1.890918e+00,5.291244e+00,-1.531465e+00,
1.000000e-02,1.953321e+01,-3.203511e+02,1.299669e+00,-1.286406e+01,5.291150e+00,-1.218249e+01,
1.414214e-02,1.952460e+01,-7.016443e+02,1.299355e+00,-2.049243e+01,5.290856e+00,-1.925665e+01,
2.514756e-02,1.943362e+01,-1.321694e+03,1.295881e+00,-6.951397e+01,5.287479e+00,-7.099950e+01,
3.556403e-02,1.922761e+01,-4.526353e+02,1.287021e+00,-5.487948e-01,5.277730e+00,-4.998128e+01,
2.011964e-01,1.205276e+01,1.925700e+02,1.106926e+00,-3.037605e+00,4.716415e+00,2.185484e+01,
2.845347e-01,8.848140e+00,9.924714e+01,9.908440e-01,-2.760495e+00,4.450497e+00,-1.698313e+01,
4.023804e-01,5.627023e+00,9.110688e+01,8.033289e-01,1.477706e+00,3.975483e+00,-2.358820e-01,
5.690518e-01,3.047870e+00,4.568512e+01,5.641439e-01,2.527024e+00,3.244746e+00,8.825614e-02,
8.047608e-01,1.537782e+00,1.042338e+01,3.309126e-01,1.669614e+00,2.249987e+00,4.040421e+00,
1.138104e+00,7.187201e-01,3.196393e+00,1.544212e-01,7.929946e-01,1.187682e+00,4.744491e+00,
1.609503e+00,2.721901e-01,9.336613e-01,5.616244e-02,1.978036e-01,4.518814e-01,1.638948e+00,
2.276181e+00,8.129469e-02,5.002366e-01,1.646340e-02,1.039626e-01,1.335978e-01,8.006320e-01,
};

/******************************************************************************/
/*									      */
/******************************************************************************/
double sdvilf5(double I,double d,double n,double t,double w,double delta)
// double I,d,n,t,w,delta;
{
	int	j;
	double	B,D,wt,m,j1,j2,af;

	if(delta == 0.0){
		af = jw5(1,t,w) + jw5(2,t,2*w);
	}
	else {
		j1 = fij(1,0,delta)*jw5(0,t,w)+
		     fij(1,1,delta)*jw5(1,t,w)+
		     fij(1,2,delta)*jw5(2,t,w);
		j2 = fij(2,0,delta)*jw5(0,t,2*w)+
		     fij(2,1,delta)*jw5(1,t,2*w)+
		     fij(2,2,delta)*jw5(2,t,2*w);
		af = j1 + j2;		
	}
	af = 1.5*I*(I+1)*n*C*t/(d*d*d) * af;
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double jw5(int k,double t,double w)
// int	k;
// double t,w;
{
	int	j,i,p;
	double	wt,m,af,*x,*y,*y2,*xx,*yy,ypn;

	x  = dvector(1,Ndt+1);
	y  = dvector(1,Ndt+1);
	y2 = dvector(1,Ndt+1);

	wt = sqrt(w*t);
	for(j=0,i= -1;j<=Ndt;j++) {
		x[j+1] = jwdev[j][0];
		y[j+1] = jwdev[j][2*k+1];
		y2[j+1]= jwdev[j][2*k+2];
		if(wt<=x[j+1] && i== -1) i=j+1;
	}
	switch(i) {
		case 1:
			dpolint(x,y,2,wt,&af,&m);
			break;
		case -1:
			af = y[Ndt+1]*x[Ndt+1]*x[Ndt+1]/(w*w);
/*
			xx = &x[Ndt];
			yy = &y[Ndt];
			dpolint(xx-1,yy-1,2,wt,&af,&m);
*/
			break;
		default:
			dsplint(x,y,y2,Ndt+1,wt,&af);
			break;
	}
	free_dvector(x,1,Ndt+1);
	free_dvector(y,1,Ndt+1);
	free_dvector(y2,1,Ndt+1);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double	jwd5(int i,double t,double w,double delta)
// int	i;
// double	t,w,delta;
{
	int	j;
	double	af;

	for(j=0,af=0.0;j<=2;j++) af += fij(i,j,delta)*jw5(j,t,w);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
double t1ro5(double I,double d,double n,double t,double w,double w0,double delta)
// double I,d,n,t,w,w0,delta;
/* B*(J0(2*w1)+10*J1(w0)+J2(2*w0) */
{
	int	j;
	double	B,D,wt,w0t,w2t,m,J0,J1,J2,af;

	J0 = jwd5(0,t,2*w,delta);
	J1 = jwd5(1,t,w0,delta);
	J2 = jwd5(2,t,2*w0,delta);
	
/*	printf("J0=%lg J1=%lg J2=%lg\n",J0,J1,J2);	*/
	af = 3.0/8.0*I*(I+1)*n*C*t/(d*d*d) * (J0 + 10*J1 + J2);
	return af;
}
/******************************************************************************/
/*									      */
/******************************************************************************/
